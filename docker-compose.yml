services:
  app:
    container_name: ripy-app
    build: ./app
    environment:
      - NODE_ENV=production
      - PORT=4000
      - DB_HOST=host.docker.internal
      - DB_USER=ripy_user
      - DB_PASSWORD=monivon0070
      - DB_NAME=ripy_token
    ports:
      - "4000:4000"
    extra_hosts:
      - "host.docker.internal:host-gateway"

  app_dev:
    container_name: ripy-app-dev
    build: ./app
    environment:
      - NODE_ENV=development
      - PORT=4001
      - DB_HOST=host.docker.internal
      - DB_USER=ripy_user
      - DB_PASSWORD=monivon0070
      - DB_NAME=ripy_token
    command: ["node","server.js"]
    ports:
      - "4001:4001"
    extra_hosts:
      - "host.docker.internal:host-gateway"

  nginx:
    image: nginx:1.25
    container_name: ripy-nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/proxy_params:/etc/nginx/proxy_params:ro
      - /var/log/nginx:/var/log/nginx
    depends_on:
      - app
      - app_dev