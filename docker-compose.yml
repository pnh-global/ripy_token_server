services:
  app:
    container_name: ripy-app
    build: ./app
    # network_mode: "host"  # ❌ 이 줄 삭제 또는 주석 처리
    ports:
      - "4000:4000"  # ✅ 추가
    environment:
      - NODE_ENV=production
      - PORT=4000
      - DB_HOST=127.0.0.1  # ⚠️ 이것도 수정 필요 (아래 참조)
      - DB_PORT=3306
      - DB_USER=ripy_user
      - DB_PASSWORD=monivon0070
      - DB_NAME=ripy_token
      - ENCRYPTION_KEY=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
      - SOLANA_RPC_ENDPOINT=https://api.devnet.solana.com
      - RIPY_TOKEN_MINT=TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA
      - COMPANY_WALLET_SECRET_KEY=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1]
      - USE_SOLANA_MOCK=true
      - COMPANY_WALLET_ADDRESS=DRpbCBMxVnDK7maPM5tGv6MvB3v1sRMC86PZ8okm21hy
    networks:  # ✅ 추가
      - ripy-network

  app_dev:
    container_name: ripy-app-dev
    build: ./app
    # network_mode: "host"  # ❌ 이 줄 삭제 또는 주석 처리
    ports:
      - "4001:4001"  # ✅ 추가
    environment:
      - NODE_ENV=development
      - PORT=4001
      - DB_HOST=127.0.0.1  # ⚠️ 이것도 수정 필요
      - DB_PORT=3306
      - DB_USER=ripy_user
      - DB_PASSWORD=monivon0070
      - DB_NAME=ripy_token
      - ENCRYPTION_KEY=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
      - SOLANA_RPC_ENDPOINT=https://api.devnet.solana.com
      - RIPY_TOKEN_MINT=TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA
      - COMPANY_WALLET_SECRET_KEY=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1]
      - USE_SOLANA_MOCK=true
      - COMPANY_WALLET_ADDRESS=DRpbCBMxVnDK7maPM5tGv6MvB3v1sRMC86PZ8okm21hy
    command: ["node","server.js"]
    networks:  # ✅ 추가
      - ripy-network

  nginx:
    image: nginx:1.25
    container_name: ripy-nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/proxy_params:/etc/nginx/proxy_params:ro
      - /var/log/nginx:/var/log/nginx
    depends_on:
      - app
      - app_dev
    networks:  # ✅ 추가
      - ripy-network

networks:  # ✅ 추가
  ripy-network:
    driver: bridge